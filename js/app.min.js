!function(e){function t(t,r){function n(){for(var e in E)delete E[e];E.length=S,C={},s()}function l(){q=[]}function o(e,n){if(!(0>=S)){E.length=S,e-=r,n+=r,e=Math.min(Math.max(e,0),E.length-1),n=Math.min(Math.max(n,0),E.length-1);for(var l=Math.floor(e/t),o=Math.floor(n/t),a=l;o>=a;a++)void 0===C[a]&&(C[a]=null);for(a=l;o>=a;a++)null===C[a]&&(k.notify({from:e,to:n}),u(a,t),p.call(m,a))}}function a(e,t){b.orderBy="ORDER BY "+(t?"ASC":"DESC")+"(?"+e+")"}function i(e,t){var r,n=/.*(PREFIX|BASE).*\n/g;for(b.prologue="",b.query=e;null!==(r=n.exec(e));)b.prologue+=r[0],b.query=b.query.replace(r[0],"");d(t)}function u(e,t){b.limit="LIMIT "+t+" OFFSET "+e*t}function s(){for(var e in F)F[e].abort();F=[]}function c(t){b.filters={},e.each(t,function(t,r){if("undefined"==typeof T[t]||r.selectedLength==T[t].length)return!0;var n=!0;(.5*T[t].length<r.selectedLength||0===r.selectedLength)&&(n=!1),b.filters[t]=b.filters[t]||"",b.filters[t]+="FILTER(";var l=0;e.each(r.values,function(e,o){if(n&&!o.isSelected||!n&&o.isSelected)return!0;var a=" && ",i=" != ",u=l==r.values.length-r.selectedLength-1;n&&(a=" || ",i=" = ",u=l==r.selectedLength-1),b.filters[t]+="STR(?"+t+")"+i+'"'+o.value+'"',u||(b.filters[t]+=a),l++}),b.filters[t]+=")\n"})}function f(t){var r={outerSelect:"SELECT DISTINCT(?"+t+") WHERE",orderBy:"ORDER BY ASC(?"+t+")"},n=g({useLimit:!1,useFilters:!0,excludeFilterColumns:[t]},r);e.ajax({dataType:"json",type:"POST",data:{query:n},url:L,callbackParameter:"callback",Accept:"application/sparql-results+json",cache:!0,success:function(r,n,l){var o=[];e.each(r.results.bindings,function(e,r){o.push(r[t].value)}),T[t]=o,O.notify({column:t,values:o})},error:function(){j.notify({msg:"Can't reach the server."}),console.log("error retrieving filter values")}})}function d(t){R&&4!=R.readystate&&R.abort(),k.notify();var r=g({useLimit:!1},{outerSelect:"SELECT COUNT(*) as ?count WHERE"});R=e.ajax({dataType:"json",type:"POST",data:{query:r},url:L,callbackParameter:"callback",Accept:"application/sparql-results+json",cache:!0,success:function(e,r,n){S=parseInt(e.results.bindings[0].count.value),E.length=S,B.notify({count:S}),t&&t()},error:function(){j.notify({msg:"Can't reach the server."}),console.log("error retrieving count query results")}})}function g(e,t){"undefined"==typeof e&&(e={}),"undefined"==typeof t&&(t={}),e.useSort=e.useSort!==!1,e.useLimit=e.useLimit!==!1,e.useFilters=e.useFilters!==!1,e.excludeFilterColumns=e.excludeFilterColumns||[],t.prologue=t.prologue||b.prologue,t.outerSelect=t.outerSelect||b.outerSelect,t.query=t.query||b.query,t.orderBy=t.orderBy||b.orderBy,t.filters=t.filters||b.filters,t.limit=t.limit||b.limit,e.useLimit||(t.limit=""),e.useSort||(t.orderBy="");var r="";if(e.useFilters)for(var n in t.filters)-1==e.excludeFilterColumns.indexOf(n)&&(r+="#filters for "+n+"\n"+t.filters[n]+"\n");var l=t.prologue+t.outerSelect+"\n{\n{"+t.query+t.orderBy+"\n}\n"+r+"}\n"+t.limit;return l}function h(e,t){var r=L+"?query="+encodeURIComponent(g(e,t));return r}function p(t){var r=g(),n=e.ajax({dataType:"json",type:"POST",data:{query:r},url:L,callbackParameter:"callback",Accept:"application/sparql-results+json",cache:!0,success:y,error:function(){j.notify({msg:"Can't reach the server."}),console.log("error loading page "+t.toString())}});n.page=t,F.push(n)}function y(t,r,n){if(F=F.filter(function(e){return e!=n}),0===q.length){var l=t.head.vars;e.each(l,function(e,t){q.push({id:t,name:t,field:t,sortable:!0})}),D.notify(q)}for(var o=(n.page,[]),a=t.results.bindings,i=0;i<a.length;i++){var u=null;u={};for(var s in a[i])u[s]=a[i][s].value;o.push(u)}loader.setPageOfData(n.page,o)}function v(e,r){C[e]=!0;for(var n=r.length,l=e*t,o=l+n-1,a=0;n>a;a++)E[l+a]=r[a];x.notify({from:l,to:o})}var m=this,S=40,E={length:0},C={},q=[],L="http://test.lindas-data.ch/sparql",T={},F=[],R=null,b={prologue:"",outerSelect:"SELECT * WHERE",query:"",orderBy:"",filters:"",limit:""},k=new Slick.Event,x=new Slick.Event,D=new Slick.Event,B=new Slick.Event,O=new Slick.Event,j=new Slick.Event;return{data:E,sparqlQuery:b,clearColumns:l,clearData:n,ensureData:o,setPageOfData:v,setSort:a,setQuery:i,setLimit:u,setFilters:c,compileQueryURL:h,compileSparqlQuery:g,updateTotalCount:d,requestFilterData:f,onDataLoading:k,onDataLoaded:x,onColumnsChanged:D,onRowCountChanged:B,onFilterValuesRetrieved:O,onErrorOccurred:j}}e.extend(!0,window,{udb:{DataLoader:t}})}(jQuery);